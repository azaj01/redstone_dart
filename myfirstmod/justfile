# Minecraft Mod Development Justfile
# Run `just` to see available commands

# Default recipe - show help
default:
    @just --list

# Build the mod
build:
    ./gradlew build --no-daemon

# Run Minecraft with the mod loaded
run:
    ./gradlew runClient --no-daemon

# Run in background and return immediately
run-bg:
    ./gradlew runClient --no-daemon &

# Generate Minecraft sources (for reading game code)
gen-sources:
    ./gradlew genSources --no-daemon

# Extract Minecraft sources to mc-sources/ folder for easy browsing
extract-sources: gen-sources
    @mkdir -p mc-sources
    @echo "Extracting common (server + shared) sources..."
    @unzip -q -o ".gradle/loom-cache/minecraftMaven/net/minecraft/minecraft-common-b00516cda8/1.21.11-loom.mappings.1_21_11.layered+hash.2198-v2/minecraft-common-b00516cda8-1.21.11-loom.mappings.1_21_11.layered+hash.2198-v2-sources.jar" -d mc-sources/common
    @echo "Extracting client-only sources..."
    @unzip -q -o ".gradle/loom-cache/minecraftMaven/net/minecraft/minecraft-clientOnly-b00516cda8/1.21.11-loom.mappings.1_21_11.layered+hash.2198-v2/minecraft-clientOnly-b00516cda8-1.21.11-loom.mappings.1_21_11.layered+hash.2198-v2-sources.jar" -d mc-sources/client
    @echo "Done! Sources available in mc-sources/"
    @echo "  - mc-sources/common/  (blocks, items, entities, etc.)"
    @echo "  - mc-sources/client/  (rendering, GUI, etc.)"

# Clean build artifacts
clean:
    ./gradlew clean --no-daemon

# Build and run
br: build run

# Rebuild from scratch
rebuild: clean build

# Run tests
test:
    ./gradlew test --no-daemon

# Check for dependency updates
deps:
    ./gradlew dependencies --no-daemon

# Package the mod as a distributable JAR
package:
    ./gradlew remapJar --no-daemon
    @echo "JAR file created at: build/libs/"
    @ls -la build/libs/*.jar 2>/dev/null || echo "No JAR files found"

# Open the mod JAR location in Finder
open-jar:
    open build/libs/

# Watch for changes and rebuild (requires entr)
watch:
    find src -name "*.java" | entr -c just build

# Format code (if configured)
format:
    ./gradlew spotlessApply --no-daemon 2>/dev/null || echo "Spotless not configured"

# Show project info
info:
    @echo "Minecraft Mod: myfirstmod"
    @echo "Minecraft Version: 1.21.11"
    @echo "Fabric Loader: 0.18.2"
    @echo "Fabric API: 0.139.4+1.21.11"
    @echo ""
    @echo "Source files:"
    @find src/main/java -name "*.java" | wc -l | xargs echo "  Java files:"
    @find src/main/resources -name "*.json" | wc -l | xargs echo "  JSON files:"
    @find src/main/resources -name "*.png" | wc -l | xargs echo "  Texture files:"
